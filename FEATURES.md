# TripGo 平台功能完整说明

## 📋 目录
1. [用户端功能](#用户端功能)
2. [管理后台功能](#管理后台功能)
3. [如何调整订单价格](#如何调整订单价格)
4. [如何查看客人订单](#如何查看客人订单)
5. [币种切换](#币种切换)
6. [语言切换](#语言切换)
7. [地点选择功能](#地点选择功能)

---

## 🎯 用户端功能

### 1. 首页搜索
- **访问地址**：`http://localhost:3000` 或 `http://localhost:3001`
- **功能**：
  - 选择服务类型：接机 / 送机 / 点到点
  - 选择出发地点（机场/区域）
  - 选择到达地点（区域/酒店）
  - 选择上车时间（显示 JST 时区）
  - 填写人数和行李数量（小/中/大）
  - 点击"搜索车型并报价"

### 2. 车型选择页 (`/vehicles`)
- **功能**：
  - 显示所有可用车型（5座、7座、9座、豪华型、大巴）
  - 显示价格明细：
    - 基础价
    - 夜间附加费（如适用）
    - 急单附加费（24小时内订单）
  - 显示车型信息：座位数、行李容量
  - 点击"选择并填写订单"进入下单页

### 3. 订单填写页 (`/checkout`)
- **功能**：
  - 填写航班信息（可选）
  - 选择/输入上车地点（支持机场航站楼选择）
  - 选择/输入下车地点（支持热门区域/酒店搜索）
  - 填写联系人信息：姓名、电话、邮箱
  - 填写特殊需求（可选）
  - 右侧显示价格明细
  - 提交订单

### 4. 订单成功页 (`/success`)
- **功能**：
  - 显示订单号
  - 显示订单详情
  - 提供链接跳转到"我的订单"页面

### 5. 我的订单页 (`/orders`)
- **功能**：
  - 用邮箱查询订单
  - 显示订单列表：订单号、上车时间、车型、金额、状态
  - 取消订单（非急单且未到用车时间）
  - 急单（24小时内）不可自助取消
  - 顶部显示旅游展示区

### 6. 语言切换
- **位置**：右上角导航栏
- **功能**：切换中文 / English
- **说明**：切换后所有页面立即更新为对应语言

### 7. 币种切换
- **位置**：右上角导航栏（Language 旁边）
- **功能**：切换 JPY（日元）/ CNY（人民币）/ USD（美元）
- **说明**：
  - 所有价格立即按选择的币种显示
  - 内部仍以 JPY 计价
  - 汇率可在 `.env` 中配置

---

## 🔧 管理后台功能

### 访问管理后台

1. **直接访问**：点击导航栏的"管理后台"链接，或直接访问：`http://localhost:3000/admin`
2. **鉴权**：输入你的 `ADMIN_SECRET_KEY`（在 `.env` 文件中设置）
3. **进入**：鉴权成功后将直接进入管理后台界面，系统会自动记录您的登录状态。

### 管理后台功能

#### 1. 查看所有订单
- **功能**：
  - 显示所有订单的列表
  - 显示信息：订单号、上车时间、路线、车型、金额、状态、是否急单
  - 支持查看订单详情

#### 2. 调整订单价格 ⭐
- **步骤**：
  1. 在订单列表中，找到要调整价格的订单
  2. 点击该订单的"编辑"按钮
  3. 在"手动调价（JPY）"字段输入调整金额：
     - **负数** = 优惠（例如：`-2000` 表示优惠 2000 日元）
     - **正数** = 加价（例如：`5000` 表示加价 5000 日元）
  4. 在"改价/备注"字段填写备注（可选，例如："深夜接送 +2000"）
  5. 点击"保存"
  6. 订单总价会自动更新 = 原价 + 手动调价

**示例**：
- 原价：10,000 JPY
- 手动调价：`-2000`（优惠）
- 新总价：8,000 JPY

#### 3. 修改订单状态
- **步骤**：
  1. 点击订单的"编辑"按钮
  2. 在"状态"下拉框选择新状态：
     - `PENDING_PAYMENT` - 待支付
     - `PAID` - 已支付
     - `CONFIRMED` - 已确认
     - `IN_SERVICE` - 服务中
     - `COMPLETED` - 已完成
     - `CANCELLED` - 已取消
  3. 点击"保存"

#### 4. 查看订单详情
- **信息包括**：
  - 订单号
  - 联系人姓名和邮箱
  - 上车时间（JST）
  - 路线信息
  - 车型
  - 价格明细（基础价、夜间费、急单费、手动调价）
  - 订单状态
  - 是否急单

---

## 📝 详细操作指南

### 如何调整订单价格

#### 方法一：通过管理后台（推荐）
1. **进入后台**：
   ```
   访问：http://localhost:3000/admin
   输入 ADMIN_SECRET_KEY
   ```

2. **找到订单并编辑**：
   - 在订单列表中找到目标订单
   - 点击"编辑"按钮

4. **调整价格**：
   - 在"手动调价（JPY）"输入框输入金额
   - 负数 = 优惠，正数 = 加价
   - 填写备注说明原因
   - 点击"保存"

#### 方法二：直接修改数据库（高级）
如果需要批量调整或更复杂的操作，可以直接修改 SQLite 数据库：
```bash
# 数据库位置
./dev.db

# 使用 Prisma Studio 可视化编辑
npx prisma studio
```

### 如何查看客人下单信息

#### 方法一：管理后台查看（推荐）
1. 解锁并登录管理后台（见上方步骤）
2. 在订单列表中可以看到所有订单
3. 点击"编辑"查看完整订单详情

#### 方法二：通过订单号查询
如果知道订单号，可以在数据库中查询：
```sql
SELECT * FROM Booking WHERE id = '订单号';
```

#### 方法三：通过邮箱查询（用户端）
1. 访问：`http://localhost:3000/orders`
2. 输入客人下单时填写的邮箱
3. 点击"查询"
4. 显示该邮箱下的所有订单

---

## 🌍 币种切换

### 用户如何切换币种
1. 点击右上角"Currency"下拉框
2. 选择：JPY / CNY / USD
3. 所有页面的价格立即更新

### 配置汇率
在 `.env` 文件中设置：
```env
USD_PER_JPY=0.0067    # 1 JPY = 0.0067 USD
CNY_PER_JPY=0.048     # 1 JPY = 0.048 CNY
```

### 后台定价基准
- **内部存储**：所有价格以 JPY 存储
- **显示转换**：根据用户选择的币种实时转换显示
- **手动调价**：在后台调整价格时，输入的是 JPY 金额

---

## 🌐 语言切换

### 用户如何切换语言
1. 点击右上角"Language"下拉框
2. 选择：中文 / English
3. 所有页面立即切换语言

### 支持的语言
- **中文**：完整翻译
- **English**：完整翻译

---

## 📍 地点选择功能

### 机场航站楼选择
- **接机时**：出发地点显示机场航站楼选项
- **送机时**：到达地点显示机场航站楼选项
- **支持的机场**：
  - 成田 (NRT) - T1, T2, T3
  - 羽田 (HND) - T1, T2, T3
  - 关西 (KIX) - T1, T2
  - 中部 (NGO)
  - 新千岁 (CTS)

### 热门区域/酒店搜索
- **输入时自动提示**：
  - 东京：新宿、涩谷、银座、浅草、上野、池袋
  - 大阪：难波、梅田、道顿堀
  - 京都：祇园、京都站
  - 热门酒店：新宿格兰贝尔、涩谷 Excel、银座万豪等

### 手动输入地址
- 支持直接输入具体地址
- 系统会保存用户输入的完整地址

---

## ⚙️ 配置说明

### 环境变量配置 (`.env`)
```env
# 数据库
DATABASE_URL="file:./dev.db"

# 管理员密钥（用于鉴权进入后台）
ADMIN_SECRET_KEY="your-secret-key-here"

# 汇率配置（可选）
USD_PER_JPY=0.0067
CNY_PER_JPY=0.048
```

### 设置 ADMIN_SECRET_KEY
1. 打开 `.env` 文件
2. 设置 `ADMIN_SECRET_KEY=你的密码`
3. 保存文件
4. 重启开发服务器

---

## 🚀 快速开始

### 1. 启动服务器
```bash
npm run dev
```

### 2. 访问平台
- 用户端：`http://localhost:3000`
- 管理后台：`http://localhost:3000/admin`

### 3. 测试下单流程
1. 首页填写搜索信息
2. 选择车型
3. 填写订单信息
4. 提交订单
5. 在后台查看并调整价格

---

## 📊 订单状态说明

- **PENDING_PAYMENT**：待支付（下单后默认状态）
- **PAID**：已支付
- **CONFIRMED**：已确认（已安排车辆）
- **IN_SERVICE**：服务中（正在接送）
- **COMPLETED**：已完成
- **CANCELLED**：已取消

---

## ⚠️ 急单规则

- **定义**：下单时间距离上车时间 < 24 小时
- **标记**：订单自动标记为"急单"
- **限制**：急单不可在用户端自助取消
- **处理**：如需取消，客人需联系客服，由管理员在后台操作

---

## 💡 常见问题

### Q: 如何重置 ADMIN_SECRET_KEY？
A: 修改 `.env` 文件中的 `ADMIN_SECRET_KEY`，然后重启服务器。

### Q: 价格调整后，客人能看到吗？
A: 可以。客人访问"我的订单"页面，用邮箱查询订单时，会看到更新后的价格。

### Q: 可以批量调整价格吗？
A: 目前需要在后台逐个订单调整。如需批量操作，可以使用 Prisma Studio 或直接操作数据库。

### Q: 如何添加新的车型？
A: 使用 Prisma Studio 或直接修改数据库：
```bash
npx prisma studio
```

### Q: 如何添加新的价格规则？
A: 在数据库中插入 `PricingRule` 记录，或使用 Prisma Studio 添加。

---

## 📞 技术支持

如有问题，请检查：
1. 开发服务器是否正常运行
2. `.env` 文件配置是否正确
3. 数据库是否已初始化（运行过 `npx prisma db push`）

---

**最后更新**：2025-01-27

